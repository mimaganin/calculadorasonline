---
import Base from '../layouts/BaseLayout.astro';
import AdSlot from '../components/AdSlot.astro';

const items = [
  { href: '/calculadora-de-idade/', title: 'Idade', desc: 'Anos, meses e dias', icon: '🎂' },
  { href: '/calculadora-de-imc/', title: 'IMC', desc: 'Índice de massa corporal', icon: '⚖️' },
  { href: '/calculadora-de-porcentagem/', title: 'Porcentagem', desc: 'Quanto é X% de Y', icon: '💯' },
  { href: '/gerador-de-sorteios/', title: 'Gerador de Sorteios', desc: 'Sorteie nomes ou números', icon: '🎲' },
  { href: '/dias-entre-datas/', title: 'Dias entre datas', desc: 'Diferença em dias', icon: '📆' },
  { href: '/conversor-de-temperatura/', title: 'Temperatura', desc: 'Celsius, Fahrenheit, Kelvin', icon: '🌡️' },
  { href: '/conversor-de-unidades/', title: 'Unidades', desc: 'Comprimento, peso, volume', icon: '📏' },
  { href: '/regra-de-tres/', title: 'Regra de três', desc: 'Proporções simples', icon: '➗' },
  { href: '/conversor-de-horas/', title: 'Horas', desc: 'Horas ⇄ minutos ⇄ segundos', icon: '🕒' },
  { href: '/contador-de-palavras/', title: 'Palavras', desc: 'Contador de palavras/caracteres', icon: '✍️' },
  { href: '/calculadora-de-juros/', title: 'Juros', desc: 'Simples e compostos', icon: '💰' },
];
const homeHidden = new Set([
  '/calculadora-de-idade/',
  '/calculadora-de-imc/',
  '/calculadora-de-porcentagem/',
  '/conversor-de-unidades/',
]);
---

<Base title="Calculadoras Online - Conta Rápida" description="Calculadoras Online Rápidas, Sem Complicação">
  <!-- Hero -->
  <section class="mb-6 text-center sm:text-left">
    <div class="flex items-center justify-center sm:justify-start gap-2 mb-2">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="26"
        height="26"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="1.8"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="shrink-0 text-white dark:text-blue-400"
      >
        <rect x="3" y="2" width="18" height="20" rx="3" />
        <rect x="7" y="6" width="10" height="4" />
        <path d="M8 14h.01M12 14h.01M16 14h.01M8 17h.01M12 17h.01M16 17h.01" />
      </svg>
      <h1 class="text-2xl sm:text-3xl font-bold tracking-tight text-white">
        Calculadoras Online Rápidas, Sem Complicação
      </h1>
    </div>
    <p class="mt-2 text-sm opacity-80 text-white/90">
      Descubra nossas ferramentas úteis, como calculadora de idade, IMC e muito mais!
    </p>
  </section>

  <section class="mb-4">
    <div class="rounded-xl border border-blue-200 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-800 p-4 sm:flex sm:items-center sm:justify-between gap-4">
      <div class="flex items-start gap-3 text-center sm:text-left">
        <div class="text-3xl" aria-hidden="true">🎲</div>
        <div>
          <p class="font-semibold text-blue-900 dark:text-blue-100">Novidade: Gerador de Sorteios e Números</p>
          <p class="text-sm text-blue-800 dark:text-blue-200">Monte listas ou intervalos numéricos e sorteie vencedores em segundos.</p>
        </div>
      </div>
      <a
        href="/gerador-de-sorteios/"
        class="btn inline-flex items-center justify-center gap-2 whitespace-nowrap mt-3 sm:mt-0"
        aria-label="Conhecer o novo gerador de sorteios"
      >
        Conhecer novidade
        <span aria-hidden="true">→</span>
      </a>
    </div>
  </section>

  <!-- Ad no topo do conteúdo -->
  <div class="mb-4">
    <div style="min-height:90px" class="rounded-xl border border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-900/60 p-2">
      <AdSlot slotId="3228575471" />
    </div>
  </div>

  <!-- Calculadora destaque: Idade (sem onsubmit inline) -->
  <section class="mt-4">
    <h2 class="text-xl font-semibold mb-3 flex items-center gap-2">🎯 Calculadora de Idade</h2>
    <form id="form-idade-home" class="form-wrap grid gap-3 sm:grid-cols-[1fr_auto] items-end">
      <label class="grid gap-1">
        <span class="text-sm">Data de nascimento</span>
        <input id="nasc-home" type="date" class="input border rounded p-2 w-full">
      </label>
      <button class="btn">Calcular</button>
    </form>
    <div id="saida-home" class="result"></div>

    <details class="mt-3 text-sm open:pb-2">
      <summary class="cursor-pointer opacity-80">Como calculamos?</summary>
      <p class="mt-2 opacity-80">
        Consideramos a diferença entre a data de hoje e a data informada, tratando meses com durações diferentes e anos bissextos.
      </p>
    </details>
  </section>

  <!-- Mini prévias -->
  <section class="mt-8 grid gap-6 lg:grid-cols-3">
    <div class="rounded-2xl border border-gray-200 dark:border-gray-800 p-5 bg-white/80 dark:bg-gray-900/50">
      <h3 class="text-lg font-semibold mb-3 flex items-center gap-2">⚖️ IMC rápido</h3>
      <form id="form-imc-home" class="grid gap-3">
        <label class="grid gap-1">
          <span>Peso (kg)</span>
          <input id="peso-home" type="number" step="0.1" min="1" class="input border rounded p-2" placeholder="70">
        </label>
        <label class="grid gap-1">
          <span>Altura (cm)</span>
          <input id="altura-home" type="number" step="0.1" min="30" class="input border rounded p-2" placeholder="170">
        </label>
        <button class="btn">Calcular IMC</button>
      </form>
      <div id="saida-imc-home" class="result mt-3 text-sm"></div>
    </div>

    <div class="rounded-2xl border border-gray-200 dark:border-gray-800 p-5 bg-white/80 dark:bg-gray-900/50">
      <h3 class="text-lg font-semibold mb-3 flex items-center gap-2">💯 Porcentagem express</h3>
      <form id="form-porcent-home" class="grid gap-3">
        <label class="grid gap-1">
          <span>Percentual (%)</span>
          <input id="porcent-home" type="number" step="0.1" class="input border rounded p-2" placeholder="15">
        </label>
        <label class="grid gap-1">
          <span>De (valor)</span>
          <input id="porcent-valor-home" type="number" step="0.01" class="input border rounded p-2" placeholder="200">
        </label>
        <button class="btn">Calcular</button>
      </form>
      <div id="saida-porcent-home" class="result mt-3 text-sm"></div>
    </div>

    <div class="rounded-2xl border border-gray-200 dark:border-gray-800 p-5 bg-white/80 dark:bg-gray-900/50">
      <h3 class="text-lg font-semibold mb-3 flex items-center gap-2">📏 Conversor de unidades</h3>
      <form id="form-unidades-home" class="grid gap-3">
        <label class="grid gap-1">
          <span>Valor</span>
          <input id="valor-unidades-home" type="number" step="0.0001" class="input border rounded p-2" placeholder="1">
        </label>
        <div class="grid grid-cols-2 gap-2">
          <label class="grid gap-1">
            <span>De</span>
            <select id="de-unidades-home" class="input border rounded p-2">
              <option value="km">km</option>
              <option value="m" selected>m</option>
              <option value="cm">cm</option>
              <option value="mm">mm</option>
            </select>
          </label>
          <label class="grid gap-1">
            <span>Para</span>
            <select id="para-unidades-home" class="input border rounded p-2">
              <option value="km">km</option>
              <option value="m">m</option>
              <option value="cm" selected>cm</option>
              <option value="mm">mm</option>
            </select>
          </label>
        </div>
        <button class="btn">Converter</button>
      </form>
      <div id="saida-unidades-home" class="result mt-3 text-sm"></div>
    </div>
  </section>

  <!-- Menu visual para as demais -->
  <section class="mt-8">
    <h2 class="text-xl font-semibold mb-3">Outras calculadoras</h2>
    <ul class="grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
      {items
        .filter(i => !homeHidden.has(i.href))
        .map(i => (
        <li class="group p-4 rounded-xl border border-gray-200 dark:border-gray-800 hover:shadow-sm transition">
          <a href={i.href} class="no-underline block">
            <div class="flex items-start gap-3">
              <div class="text-2xl">{i.icon}</div>
              <div>
                <h3 class="font-semibold group-hover:underline">{i.title}</h3>
                <p class="text-sm opacity-70">{i.desc}</p>
              </div>
            </div>
          </a>
        </li>
      ))}
    </ul>
  </section>

  <!-- Ad no fim do conteúdo -->
  <div class="mt-8">
    <div style="min-height:90px" class="rounded-xl bg-gray-100 dark:bg-gray-900/60 border border-gray-200 dark:border-gray-800 flex items-center justify-center text-xs">
      <AdSlot slotId="3228575471" />
    </div>
  </div>

  <!-- Script precisa ficar dentro do <Base> -->
  <script is:inline>
    const numberFormatter = new Intl.NumberFormat('pt-BR', { maximumFractionDigits: 2 });

    function diffYMD(from, to) {
      let y = to.getFullYear() - from.getFullYear();
      let m = to.getMonth() - from.getMonth();
      let d = to.getDate() - from.getDate();
      if (d < 0) {
        const prevMonth = new Date(to.getFullYear(), to.getMonth(), 0);
        d += prevMonth.getDate();
        m -= 1;
      }
      if (m < 0) { m += 12; y -= 1; }
      return { y, m, d };
    }

    document.getElementById('form-idade-home').addEventListener('submit', (e) => {
      e.preventDefault();
      const nasc = document.getElementById('nasc-home').value;
      if (!nasc) return;
      const from = new Date(nasc + 'T00:00:00');
      const to = new Date();
      const { y, m, d } = diffYMD(from, to);
      document.getElementById('saida-home').textContent = `${y} anos, ${m} meses e ${d} dias`;
    });

    document.getElementById('form-imc-home').addEventListener('submit', (e) => {
      e.preventDefault();
      const peso = parseFloat(document.getElementById('peso-home').value.replace(',', '.'));
      const alturaCm = parseFloat(document.getElementById('altura-home').value.replace(',', '.'));
      const saida = document.getElementById('saida-imc-home');
      if (isNaN(peso) || isNaN(alturaCm) || peso <= 0 || alturaCm <= 0) {
        saida.textContent = 'Informe peso e altura válidos.';
        return;
      }
      const alturaM = alturaCm / 100;
      const imc = peso / (alturaM * alturaM);
      let classificacao = '';
      if (imc < 18.5) classificacao = 'Abaixo do peso';
      else if (imc < 25) classificacao = 'Peso ideal';
      else if (imc < 30) classificacao = 'Sobrepeso';
      else classificacao = 'Obesidade';
      saida.textContent = `IMC: ${numberFormatter.format(imc)} (${classificacao})`;
    });

    document.getElementById('form-porcent-home').addEventListener('submit', (e) => {
      e.preventDefault();
      const pct = parseFloat(document.getElementById('porcent-home').value.replace(',', '.'));
      const valor = parseFloat(document.getElementById('porcent-valor-home').value.replace(',', '.'));
      const saida = document.getElementById('saida-porcent-home');
      if (isNaN(pct) || isNaN(valor)) {
        saida.textContent = 'Preencha percentual e valor.';
        return;
      }
      const resultado = (pct / 100) * valor;
      saida.textContent = `${pct}% de ${numberFormatter.format(valor)} = ${numberFormatter.format(resultado)}`;
    });

    document.getElementById('form-unidades-home').addEventListener('submit', (e) => {
      e.preventDefault();
      const valor = parseFloat(document.getElementById('valor-unidades-home').value.replace(',', '.'));
      const de = document.getElementById('de-unidades-home').value;
      const para = document.getElementById('para-unidades-home').value;
      const saida = document.getElementById('saida-unidades-home');
      if (isNaN(valor)) {
        saida.textContent = 'Informe um valor válido.';
        return;
      }
      const fatores = { km: 1000, m: 1, cm: 0.01, mm: 0.001 };
      const emMetros = valor * fatores[de];
      const convertido = emMetros / fatores[para];
      saida.textContent = `${numberFormatter.format(valor)} ${de} = ${numberFormatter.format(convertido)} ${para}`;
    });
  </script>
</Base>

