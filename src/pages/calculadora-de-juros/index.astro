---
import Base from '../../layouts/BaseLayout.astro';
import CalculatorsGrid from '../../components/CalculatorsGrid.astro';
---

<Base title="Calculadora de juros" description="Juros simples e compostos.">
  <!-- CSS já importado no layout -->
  <h1 class="text-2xl font-semibold mb-4">Calculadora de juros</h1>

  <form id="form-juros" class="form-wrap grid gap-3">
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
      <label class="grid gap-1">
        <span>Capital (C)</span>
        <input id="c" type="number" inputmode="decimal" step="0.01" class="input border rounded p-2" placeholder="1000">
      </label>

      <label class="grid gap-1">
        <span>Taxa (%) por período</span>
        <input id="i" type="number" inputmode="decimal" step="0.0001" class="input border rounded p-2" placeholder="1.5">
      </label>

      <label class="grid gap-1">
        <span>Tempo (t)</span>
        <input id="t" type="number" step="1" class="input border rounded p-2" placeholder="12">
      </label>

      <label class="grid gap-1">
        <span>Tipo</span>
        <select id="tipo" class="input border rounded p-2">
          <option>Simples</option>
          <option>Compostos</option>
        </select>
      </label>
    </div>

    <button class="btn">Calcular</button>
  </form>

  <div id="saida" class="result"></div>

  <section class="prose dark:prose-invert mt-6">
    <h2>Fórmulas</h2>
    <ul>
      <li>Juros simples: <code>J = C × i × t</code></li>
      <li>Juros compostos: <code>M = C × (1 + i)<sup>t</sup></code></li>
    </ul>
  </section>

  <script is:inline>
    function format(n) {
      // formatação simples; ajuste para pt-PT/pt-BR se quiser com Intl.NumberFormat
      return Number(n).toFixed(2);
    }

    document.getElementById('form-juros').addEventListener('submit', (e) => {
      e.preventDefault();

      const C = parseFloat(document.getElementById('c').value);
      const i = parseFloat(document.getElementById('i').value) / 100; // taxa em decimal
      const t = parseInt(document.getElementById('t').value, 10);
      const tipo = document.getElementById('tipo').value;

      if ([C, i, t].some(v => isNaN(v)) || C <= 0 || t < 0) {
        document.getElementById('saida').textContent = 'Preencha os campos corretamente.';
        return;
      }

      let J, M, result;
      if (tipo === 'Simples') {
        J = C * i * t;
        M = C + J;
        result = `Juros: ${format(J)} | Montante: ${format(M)}`;
      } else {
        M = C * Math.pow(1 + i, t);
        J = M - C;
        result = `Juros: ${format(J)} | Montante: ${format(M)}`;
      }

      document.getElementById('saida').textContent = result;
    });
  </script>
  <CalculatorsGrid current={Astro.url.pathname} />
</Base>