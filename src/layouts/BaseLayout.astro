---
import '../styles/global.css';
import { CALCS } from '../data/calculators.js';
import CookieConsent from '../components/CookieConsent.astro';
import AdSlot from '../components/AdSlot.astro';

const {
  title = 'Calculadoras Online - Conta Rápida',
  description = 'Calculadoras online para facilitar seu dia a dia: idade, IMC, juros e mais!',
} = Astro.props;
---

<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>{title}</title>
  <meta name="description" content={description} />

  <!-- Favicon e ícones -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png">
  <link rel="icon" href="/favicon.ico">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#2563eb">
  <meta name="msapplication-TileColor" content="#2563eb">
  <meta name="theme-color" content="#2563eb">

  <!-- SEO e compartilhamento -->
  <meta property="og:title" content={title}>
  <meta property="og:description" content={description}>
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://conta-rapida.com">
  <meta property="og:image" content="/android-chrome-512x512.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content={title}>
  <meta name="twitter:description" content={description}>

  <!-- Performance -->
  <link rel="preconnect" href="https://pagead2.googlesyndication.com" crossorigin>
  <link rel="dns-prefetch" href="https://pagead2.googlesyndication.com">

  <!-- Google tag (GA4) + Consent Mode (default: denied) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-E1TZBLE3G1"></script>
  <script is:inline>
    // Consent Mode v2: tudo negado até a CMP/botão aceitar
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }

    gtag('consent', 'default', {
      'ad_storage': 'denied',
      'ad_user_data': 'denied',
      'ad_personalization': 'denied',
      'analytics_storage': 'denied'
    });

    gtag('js', new Date());
    // Dica: anonimização de IP ajuda GDPR
    gtag('config', 'G-E1TZBLE3G1', { 'anonymize_ip': true });

    // Fallback para regiões fora da UE (se você usar seu CookieConsent custom)
    window.enableAnalyticsAndAds = function () {
      gtag('consent', 'update', {
        'ad_storage': 'granted',
        'ad_user_data': 'granted',
        'ad_personalization': 'granted',
        'analytics_storage': 'granted'
      });
    };
  </script>

  <!-- Google CMP (Funding Choices) - mostra a mensagem no EEE/UK/CH -->
  <script async src="https://fundingchoicesmessages.google.com/i/pub-0421373105939215?ers=1"></script>
  <script is:inline>
    (function() {
      // Sinaliza ao Google que a CMP está presente
      function signalGooglefcPresent() {
        if (!window.frames['googlefcPresent']) {
          if (document.body) {
            const iframe = document.createElement('iframe');
            iframe.style.cssText = 'width:0;height:0;border:0;display:none';
            iframe.name = 'googlefcPresent';
            document.body.appendChild(iframe);
          } else {
            setTimeout(signalGooglefcPresent, 0);
          }
        }
      }
      signalGooglefcPresent();
    })();
  </script>

  <!-- Google AdSense -->
  <script
    async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0421373105939215"
    crossorigin="anonymous">
  </script>
</head>

  <body>
    <CookieConsent />
    <div class="min-h-screen bg-gradient-to-b from-gray-50 to-white dark:from-gray-950 dark:to-gray-950">
      <!-- Header fixo -->
      <header class="sticky top-0 z-40 backdrop-blur bg-white/70 dark:bg-gray-950/60 border-b border-gray-200/70 dark:border-gray-800">
        <div class="container flex items-center justify-between py-3 gap-4">
          <a href="/" class="flex items-center gap-2 no-underline">
            <!-- Ícone de calculadora azul minimalista -->
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="26"
              height="26"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.8"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="text-blue-600 dark:text-blue-400"
            >
              <rect x="3" y="2" width="18" height="20" rx="3" />
              <rect x="7" y="6" width="10" height="4" />
              <path d="M8 14h.01M12 14h.01M16 14h.01M8 17h.01M12 17h.01M16 17h.01" />
            </svg>
            <span class="font-bold text-lg">Conta Rápida</span>
          </a>

          <!-- MENUS DESKTOP: rolagem horizontal -->
          <div class="hidden md:block overflow-x-auto no-scrollbar">
            <nav class="flex items-center gap-3 text-sm whitespace-nowrap">
              {CALCS.map(i => (
                <a class="hover:underline" href={i.href}>{i.title}</a>
              ))}
            </nav>
          </div>

          <button
            class="md:hidden p-2 rounded-lg border border-gray-200 dark:border-gray-800"
            onclick="document.getElementById('mnav').classList.toggle('hidden')"
            aria-label="Abrir menu">
            ☰
          </button>
        </div>

        <!-- Mobile nav (lista completa) -->
        <div id="mnav" class="md:hidden hidden border-t border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-950">
          <div class="container grid grid-cols-2 gap-2 py-3 text-sm">
            {CALCS.map(i => (<a href={i.href}>{i.title}</a>))}
          </div>
        </div>
      </header>

      <!-- Grid principal -->
      <main class="container py-6 grid gap-6 lg:grid-cols-[minmax(0,1fr)_320px]">
        <article class="card">
          <slot />
        </article>

        <!-- Sidebar: todas as calculadoras + anúncio -->
        <aside class="space-y-4">
          <section class="card">
            <h3 class="font-semibold mb-2">Todas as calculadoras</h3>
            <ul class="grid grid-cols-1 gap-1 text-sm max-h-80 overflow-auto no-scrollbar pr-1">
              {CALCS.map(i => (
                <li><a href={i.href}>{i.icon} {i.title}</a></li>
              ))}
            </ul>
          </section>

          <!-- Ad slot da sidebar -->
          <section class="card">
            <div style="min-height:250px" class="rounded-xl border border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-900/60 p-2">
              <AdSlot slotId="6940589775" />
            </div>
          </section>
        </aside>
      </main>

      <footer class="mt-2 pb-10 text-center text-sm opacity-70">
        <p>© {new Date().getFullYear()} Calculadoras Rápidas · <a href="/sobre/">Sobre</a> · <a href="/politica-privacidade/">Privacidade</a></p>
      </footer>
    </div>

    <script>
      // Dark mode conforme preferência do sistema
      (function(){
        const mq = window.matchMedia('(prefers-color-scheme: dark)');
        document.documentElement.classList.toggle('dark', mq.matches);
        mq.addEventListener('change', e => document.documentElement.classList.toggle('dark', e.matches));
      })();
    </script>
  </body>
</html>